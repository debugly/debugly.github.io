<!DOCTYPE html>
<html>
  <head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
  <meta name="description" content="Matt Reach&#39;s blog">
  <meta name="keyword" content="Rake 入门,Ruby 简介,许乾隆,Matt Reach">
  
    <link rel="shortcut icon" href="/css/images/logo.png">
  
  <title>
    
      使用 Rake 重写打包脚本 | Matt Reach
    
  </title>
  
    <link rel="stylesheet" href="/css/style.css">
<link rel="stylesheet" href="/css/plugins/gitment.css">
  
  <link href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <link href="//cdn.bootcss.com/nprogress/0.2.0/nprogress.min.css" rel="stylesheet">
  <link href="//cdn.bootcss.com/highlight.js/9.12.0/styles/tomorrow.min.css" rel="stylesheet">
  
  <script src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>
  <script src="//cdn.bootcss.com/geopattern/1.2.3/js/geopattern.min.js"></script>
  <script src="//cdn.bootcss.com/nprogress/0.2.0/nprogress.min.js"></script>
  <script src="/js/qrious.js"></script>
<script src="/js/gitment.js"></script>
</head>
<div class="wechat-share">
  <img src="/css/images/logo.png" />
</div>

  <body>
    <header class="header fixed-header">
  <div class="header-container">
    <a class="home-link" href="/">
      <div class="logo"></div>
      <span>Matt Reach</span>
    </a>
    <ul class="right-list">
      
        <li class="list-item">
          
            <a href="/" class="item-link">Home</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/archives/" class="item-link">Archives</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/tags/" class="item-link">Tags</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/project/" class="item-link">Projects</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/about/" class="item-link">About</a>
          
        </li>
      
    </ul>
    <div class="menu">
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </div>
    <div class="menu-mask">
      <ul class="menu-list">
        
          <li class="menu-item">
            
              <a href="/" class="menu-link">Home</a>
            
          </li>
        
          <li class="menu-item">
            
              <a href="/archives/" class="menu-link">Archives</a>
            
          </li>
        
          <li class="menu-item">
            
              <a href="/tags/" class="menu-link">Tags</a>
            
          </li>
        
          <li class="menu-item">
            
              <a href="/project/" class="menu-link">Projects</a>
            
          </li>
        
          <li class="menu-item">
            
              <a href="/about/" class="menu-link">About</a>
            
          </li>
        
      </ul>
    </div>
  </div>
</header>

    <div id="article-banner">
  <h2>使用 Rake 重写打包脚本</h2>
  <!-- Tags START -->
  
    <div class="tags">
      <span><i class="fa fa-tags"></i> Tags:</span>

  <a href="/tags#Script" >
    <span class="tag-code">Script</span>
  </a>

    </div>
  
  <!-- Tags END -->
  <p class="post-date">2017-06-04</p>
  <div class="arrow-down">
    <a href="javascript:;"></a>
  </div>
</div>
<main class="app-body flex-box">
  <!-- Article START -->
  <article class="post-article">
      
    <section class="markdown-content"><blockquote>
<p>我最初的博客系统使用的是 Octopress，创建博客或者预览博客都是使用的 <code>rake</code> 命令，感觉很是方便，现在虽然直接使用了 Jekyll，但是这套命令还是被我移植过来继续使用着。之前我用 Shell 编写过一套打包的脚本，现在接触了 Ruby 脚本，对比之下感觉 Shell 这门语言太不友好了，编程效率很低，于是前天晚上开始学习 <code>rake</code>，边写边学边查资料，一步步的重写了这套打包脚本，故趁热打铁写下这篇博客记录用到的知识点。</p>
</blockquote>
<p>Ruby 语言的图标:</p>
<p><img src="/images/201706/ruby.png" alt=""></p>
<h2 id="名词解释"><a href="#名词解释" class="headerlink" title="名词解释"></a>名词解释</h2><p>学习 Ruby 之前先捋顺下相关的名词吧</p>
<ul>
<li><p>Ruby: 是一门纯粹的面向对象编程语言，她语法简洁优美，简单易学，兼具函数式编程和命令式编程特色，由日本的松本行弘创建，松本行弘被称为 Matz 。这是 Ruby 中文官网: <a href="http://www.ruby-lang.org/zh_cn/" target="_blank" rel="noopener">http://www.ruby-lang.org/zh_cn/</a></p>
</li>
<li><p>RVM: 用来管理 Ruby 版本及相关插件，方便切换版本环境。</p>
</li>
<li><p>Ruby on Rails: 开发 web 应用的框架。</p>
</li>
<li><p>Gem: 组织 Ruby 程序或者代码类库的包，每个 Ruby 应用程序就是一个 gem 包。</p>
</li>
<li><p>RubyGems: 方便而强大的 Ruby 程序包管理器，用来管理 gem 的，类似 RedHat 的 RPM；Ruby环境里已经包含了 RubyGems 了，无需额外安装。</p>
<ul>
<li>Ruby 社区的 Gem 托管服务: <a href="https://rubygems.org/" target="_blank" rel="noopener">RubyGems.org</a></li>
<li>RubyGems 镜像 <a href="https://gems.ruby-china.org/" target="_blank" rel="noopener">gems.ruby-china.org</a></li>
<li>RubyGems 镜像 <a href="https://ruby.taobao.org/" target="_blank" rel="noopener">ruby.taobao.org</a></li>
<li>使用 <code>gem list</code> 可查看已经安装的 gem 包</li>
</ul>
</li>
<li><p>Rake: 如果你已经查看了所有安装的 gem 包的话，你会发现其中一个就是 <code>rake (10.5.0, 10.4.2)</code>，这个是很重要的一个 gem。跟 Make 类似，是一个 DSL 构建语言，Rails 有很多任务常用 rake 来完成。</p>
</li>
<li><p>Rakefile: 使用 Ruby 语言按照 DSL 格式编写的文件，定义了 Rake 的执行过程。</p>
</li>
</ul>
<h2 id="Ruby-基础知识"><a href="#Ruby-基础知识" class="headerlink" title="Ruby 基础知识"></a>Ruby 基础知识</h2><p>编写 Rakefile 必须知道 Ruby 的语法才行，简单学习下吧：</p>
<ul>
<li><p>特殊变量的命名规则</p>
<ul>
<li>常量: 以大写字母开头的变量，如: Jekyll，为方便起见常量全部大写</li>
<li>全局变量: 以”$”开头的变量，如: $jekyll</li>
<li>实例变量: 以”@”开头的变量，如: @jekyll</li>
<li><p>类变量: 以”@@”开头的变量，如: @@jekyll</p>
<p>我最初不知道大写字母开头的是常量，原本想的是使用全局变量的，结果改变了常量的值，执行时发现了警告：<br><code>warning: already initialized constant JEKYLL</code><br>所以最好不要修改常量的值！</p>
</li>
<li><p>__FILE__: 当前源文件的名称(含路径)</p>
</li>
<li>__LINE__: 当前行在源代码中的编号</li>
</ul>
</li>
<li><p>注释</p>
<ul>
<li>单行注释: ‘#单行注释’</li>
<li><p>多行注释:</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">=begin</span></span><br><span class="line"><span class="comment">多行注释</span></span><br><span class="line"><span class="comment">多行注释</span></span><br><span class="line"><span class="comment">多行注释</span></span><br><span class="line"><span class="comment">=end</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>输出日志: puts “log something”，跟 printf 类似</p>
</li>
<li><p>数组</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">ary = [<span class="string">"abc"</span>,<span class="number">19</span>,<span class="number">3.14</span>,<span class="string">"This is my pubby"</span>]</span><br><span class="line"><span class="comment"># 等同于</span></span><br><span class="line">arr = Array.new</span><br><span class="line">arr[<span class="number">0</span>] = <span class="string">"abc"</span></span><br><span class="line">arr[<span class="number">1</span>] = <span class="number">19</span></span><br><span class="line">arr[<span class="number">2</span>] = <span class="number">3.14</span></span><br><span class="line">arr[<span class="number">3</span>] = <span class="string">"This is my pubby"</span></span><br><span class="line"><span class="comment"># 遍历数组</span></span><br><span class="line">ary.each <span class="keyword">do</span> <span class="params">|i|</span></span><br><span class="line">   puts i</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>Hash，OC 里叫字典</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">colors = &#123;<span class="string">"red"</span> =&gt; <span class="number">0xff0000</span>, <span class="string">"green"</span> =&gt; <span class="number">0x00ff00</span>,<span class="string">"blue"</span> =&gt; <span class="number">0x0000ff</span>&#125;</span><br><span class="line"><span class="comment"># 遍历 Hash</span></span><br><span class="line">colors.each <span class="keyword">do</span> <span class="params">|key,value|</span></span><br><span class="line">  print key,<span class="string">" is "</span>,value, <span class="string">"\n"</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>Sequence 序列</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">seq = (<span class="number">10</span>..<span class="number">15</span>)</span><br><span class="line">seq.each <span class="keyword">do</span> <span class="params">|n|</span></span><br><span class="line">     print n,<span class="string">' '</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>字符串: “Hello World”</p>
</li>
<li><p>特殊语句块</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">BEGIN</span>&#123;</span><br><span class="line">   puts <span class="string">"【执行其他代码前，先执行BEGIN块里的语句！】"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">END</span>&#123;</span><br><span class="line">   puts <span class="string">"【执行完其他所有代码后，再执行END块里的语句！】"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>方法</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test</span><span class="params">(content)</span></span></span><br><span class="line">   puts <span class="string">"### "</span> + content</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="Rake-入门"><a href="#Rake-入门" class="headerlink" title="Rake 入门"></a>Rake 入门</h2><ul>
<li><p>Rakefile</p>
<p> 先创建名为 Rakefile 的文件，然后就可以按照格式写了:</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">desc <span class="string">"task 说明"</span></span><br><span class="line">task <span class="symbol">:test</span> <span class="keyword">do</span></span><br><span class="line">  puts <span class="string">"I'm a task"</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>  在 Rakefile 目录打开终端并执行: <code>rake test</code>，你会发现测试语句输出了；这就是 Rake 的模板，可以通过 <code>rake -T</code> 查看定义的所有 task，desc 会作为文档显示出来:</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">xuqianlong$ rake test</span><br><span class="line">I<span class="string">'m a task</span></span><br><span class="line"><span class="string">xuqianlong$ rake -T</span></span><br><span class="line"><span class="string">rake test  # task 说明</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>namespace</p>
<p> 你可能会定义多个 task，这样一来可能会不好命名或者冲突，辛好可以通过 <code>namespace</code> 来解决，如果有命名空间的话，执行的时候带上才行，比如：</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 添加到 Rakefile 里</span></span><br><span class="line">namespace <span class="symbol">:TestNamespace</span> <span class="keyword">do</span></span><br><span class="line">  desc <span class="string">"test namespace 说明"</span></span><br><span class="line">  task <span class="symbol">:test</span> <span class="keyword">do</span></span><br><span class="line">    puts <span class="string">"I have a namespace."</span></span><br><span class="line">   <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="comment"># 命令行继续执行</span></span><br><span class="line">xuqianlong$ rake -T</span><br><span class="line">rake <span class="symbol">TestNamespace:</span>test  <span class="comment"># test namespace 说明</span></span><br><span class="line">rake test                <span class="comment"># task 说明</span></span><br><span class="line">xuqianlong$ rake <span class="symbol">TestNamespace:</span>test</span><br><span class="line">I have a namespace.</span><br></pre></td></tr></table></figure>
</li>
<li><p>default task</p>
<p> 可以在 Rakefile 里指定默认的 task，然后执行时就不用带上 task 名字了</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 添加到 Rakefile 里</span></span><br><span class="line">task <span class="symbol">:default</span> =&gt; [<span class="symbol">:test</span>]</span><br><span class="line"><span class="comment"># 调用</span></span><br><span class="line">xuqianlong$ rake</span><br><span class="line">I<span class="string">'m a task</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>import</p>
<p>  为了减轻 Rakefile 的压力，可以把代码分散到不同的 rake 文件里，然后使用 import 导入即可，可以包含 task 任务，也可以包含 ruby 代码哦；<br>  buildConfig.rake 里放了打包的先关配置信息，放在config目录下，这样导入就行了：</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">import(<span class="string">"config/buildConfig.rake"</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p>invoke</p>
<p>一个 task 可以调用别的 task，代码如下:</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># PackageSDK 是命名空间, prepareBuildFolder 是 task 的名字</span></span><br><span class="line">Rake::Task[<span class="string">"PackageSDK:prepareBuildFolder"</span>].invoke</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="Call-Shell"><a href="#Call-Shell" class="headerlink" title="Call Shell"></a>Call Shell</h2><p>打包的命令是 Shell 命令，所以要想办法让 ruby 去调用才行，查到了一下方法:</p>
<ul>
<li><p>反引号 (Backticks) : `cmd`</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 可以获取到命令的返回值</span></span><br><span class="line">xcversion = <span class="string">`xcodebuild -version`</span></span><br><span class="line">puts xcversion</span><br></pre></td></tr></table></figure>
</li>
<li><p>system “cmd”</p>
  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Hi 会被直接输出到命令行</span></span><br><span class="line">system <span class="string">"echo Hi"</span></span><br><span class="line"><span class="comment"># 可以通过 $? 获取子进程 pid 和执行结果</span></span><br><span class="line">pid <span class="number">48526</span> exit <span class="number">0</span></span><br><span class="line"><span class="comment"># 可以 $?.to_i 获取执行结果，如果是 0 这说明正常执行</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="YAML"><a href="#YAML" class="headerlink" title="YAML"></a>YAML</h2><p>在 Ruby 的世界里，他使用很广泛，可读性很好，用来取代 XML 标记语言，比 XML 更有优势；一般用作配置文件，因此之前用 shell 写的配置文件就改为 .yml 文件了:</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">DESC:</span> <span class="string">"SohuLiveSDK for Video"</span></span><br><span class="line"><span class="symbol">SCHEME_NAME_ARR:</span> [<span class="string">"SohuCoreFoundation"</span>,<span class="string">"SohuOneSDK"</span>,<span class="string">"SohuGameSDK"</span>,<span class="string">"SohuLiveSDK-Video"</span>]</span><br><span class="line"><span class="symbol">PLIST_INFO:</span> <span class="string">"SohuLiveSDK/SohuLiveSDK/video-info.plist"</span></span><br><span class="line"><span class="symbol">CATEGORY_NAME:</span> <span class="string">"千帆SDK-Video"</span></span><br></pre></td></tr></table></figure>
<p>读取配置文件内容:</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 读出来后是 HASH 类型，很方便使用</span></span><br><span class="line">config = YAML::load(File.read(cfgdir, cfgname)))</span><br></pre></td></tr></table></figure>
<p>使用前需要导入库哦:</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">require</span> <span class="string">'yaml'</span></span><br></pre></td></tr></table></figure>
<h2 id="STDIN"><a href="#STDIN" class="headerlink" title="STDIN"></a>STDIN</h2><p>所有的打包渠道都放在 PLACE_CONF_ARR 数组中，使用者需要选择打哪个渠道，因此须要求输入 1 ~ N 之间的数字，其中 N = PLACE_CONF_ARR.size，代表打包渠道数组长度，代码如下</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">input = <span class="number">0</span></span><br><span class="line"><span class="keyword">until</span> (input &gt; <span class="number">0</span>) &amp;&amp; (input &lt;= PLACE_CONF_ARR.size)</span><br><span class="line">	puts <span class="string">"请输入1~"</span> + PLACE_CONF_ARR.size.to_s + <span class="string">"之间的数字:"</span></span><br><span class="line">	input = $stdin.gets.chomp().to_i</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<h2 id="Installed-xx-Gem"><a href="#Installed-xx-Gem" class="headerlink" title="Installed xx Gem ?"></a>Installed xx Gem ?</h2><p>我使用了 xcpretty 将 xcodebuild 的输出信息格式化，但是同事的电脑可能没装 xcpretty，因此要判断出来是否安装了，如果没安装就不使用，这样程序才算健壮，逻辑为：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#定义一个全局变量</span></span><br><span class="line">$g_xcpretty = <span class="literal">false</span></span><br><span class="line"><span class="comment"># 判断下是否安装了 xcpretty</span></span><br><span class="line">isInstalled = <span class="string">`gem list -i xcpretty`</span></span><br><span class="line"><span class="comment"># 去掉末尾的换行符</span></span><br><span class="line">isInstalled = isInstalled.chomp();</span><br><span class="line"><span class="comment"># 如果是 "true" 则表明安装了</span></span><br><span class="line"><span class="keyword">if</span> isInstalled == <span class="string">"true"</span></span><br><span class="line">   $g_xcpretty = <span class="literal">true</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ...</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 剩下的逻辑通过 $g_xcpretty 全局变量判断即可</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">build_sdk_scheme</span><span class="params">(sdk,scheme)</span></span></span><br><span class="line">   puts <span class="string">"========== Build <span class="subst">#&#123;scheme&#125;</span> On <span class="subst">#&#123;sdk&#125;</span> Platform =========="</span></span><br><span class="line">   <span class="keyword">if</span> $g_xcpretty</span><br><span class="line">      system <span class="string">"/usr/bin/xcodebuild -workspace <span class="subst">#&#123;wksp&#125;</span> -scheme <span class="subst">#&#123;scheme&#125;</span> -configuration <span class="subst">#&#123;CONFIGURATION&#125;</span> -sdk <span class="subst">#&#123;sdk&#125;</span> BUILD_DIR=<span class="subst">#&#123;build_dir&#125;</span>"</span> <span class="params">| xcpretty</span></span><br><span class="line"><span class="params">   <span class="keyword">else</span></span></span><br><span class="line"><span class="params">      system "/usr/bin/xcodebuild -workspace #&#123;wksp&#125; -scheme #&#123;scheme&#125; -configuration #&#123;CONFIGURATION&#125; -sdk #&#123;sdk&#125; BUILD_DIR=#&#123;build_dir&#125;"</span></span><br><span class="line"><span class="params">   <span class="keyword">end</span></span></span><br><span class="line"><span class="params"><span class="keyword">end</span></span></span><br></pre></td></tr></table></figure>
</section>
    <!-- Post Nav START -->
    
      <div class="postnav">
          
    <div>
        <span>上一篇 :</span>
        <a href="/2017/06/01-reduce-framework-weight.html">iOS Framework 瘦身实战</a>
      </div>
   
  
    <div>
        <span>下一篇 : </span>
        <a href="/2017/06/18-my-mbp-adversity.html">Fuck，Mac 关机后再也无法启动</a>
    </div>
   
      </div>
      
    <!-- Post Nav END -->
      
    <!-- 打赏 START -->
    
      <div class="money-like">
        <div class="reward-btn">
          赏
          <span class="money-code">
            <span class="alipay-code">
              <div class="code-image"></div>
              <b>使用支付宝打赏</b>
            </span>
            <span class="wechat-code">
              <div class="code-image"></div>
              <b>使用微信打赏</b>
            </span>
          </span>
        </div>
        <p class="notice">若你觉得我的文章对你有帮助，欢迎点击上方按钮对我打赏</p>
      </div>
    
    <!-- 打赏 END -->
    <!-- 二维码 START -->
    
      <div class="qrcode">
        <canvas id="share-qrcode"></canvas>
        <p class="notice">扫描二维码，分享此文章</p>
      </div>
    
    <!-- 二维码 END -->
    
      <!-- Gitment START -->
      <div id="comments"></div>
      <!-- Gitment END -->
    

  </article>
  <!-- Article END -->
  <!-- Catalog START -->
  
  <!-- Catalog END -->
</main>

<script>
  (function () {
    var banner = ''
    if (banner !== '' && banner !== 'undefined' && banner !== 'null') {
      $('#article-banner').css({
        'background-image': 'url("' + banner + '")'
      })
    } else {
      var url = 'http://debugly.cn/2017/06/04-use-rake.html';
      $('#article-banner').geopattern(url)
    }
    $('.header').removeClass('fixed-header')

     // error image
    $(".markdown-content img").on('error', function() {
      $(this).attr('src', '/css/images/404.png')
      $(this).css({
        'cursor': 'default'
      })
    })

    // zoom image
    $(".markdown-content img").on('click', function() {
      var src = $(this).attr('src')
      if (src !== '/css/images/404.png') {
        var imageW = $(this).width()
        var imageH = $(this).height()
        
        var zoom = ($(window).width() * 0.95 / imageW).toFixed(2)
        zoom = zoom < 1 ? 1 : zoom
        zoom = zoom > 2 ? 2 : zoom
        var transY = (($(window).height() - imageH) / 2).toFixed(2)

        $('body').append('<div class="image-view-wrap"><div class="image-view-inner"><img src="'+ src +'" /></div></div>')
        $('.image-view-wrap').addClass('wrap-active')
        $('.image-view-wrap img').css({
          'width': `${imageW}`,
          'transform': `translate3d(0, ${transY}px, 0) scale3d(${zoom}, ${zoom}, 1)`
        })
        $('html').css('overflow', 'hidden')

        $('.image-view-wrap').on('click', function() {
          $(this).remove()
          $('html').attr('style', '')
        })
      }
    })

    // qrcode
    var qr = new QRious({
      element: document.getElementById('share-qrcode'),
      value: document.location.href
    });

    // gitment
    var gitmentConfig = "debugly";
    if (gitmentConfig !== 'undefined') {
      var gitment = new Gitment({
        id: "使用 Rake 重写打包脚本",
        owner: "debugly",
        repo: "debugly.github.io",
        oauth: {
          client_id: "ce1d755873d77e993024",
          client_secret: "47471beab9dc3898e0310556a7b239db624fe919"
        },
        theme: {
          render(state, instance) {
            const container = document.createElement('div')
            container.lang = "en-US"
            container.className = 'gitment-container gitment-root-container'
            container.appendChild(instance.renderHeader(state, instance))
            container.appendChild(instance.renderEditor(state, instance))
            container.appendChild(instance.renderComments(state, instance))
            container.appendChild(instance.renderFooter(state, instance))
            return container;
          }
        }
      })
      gitment.render(document.getElementById('comments'))
    }
  })();
</script>

    <div class="scroll-top">
  <span class="arrow-icon"></span>
</div>
    <footer class="app-footer">
  <p class="copyright">
      Copyright &copy; 2018.
      Powered by <a href="https://hexo.io" target="_blank">Hexo</a>.
      Theme by <a href="https://github.com/debugly/hexo-theme-yaris">hexo-theme-yaris</a>.
      Hosted on <a href="https://github.com/" target="_blank">GitHub</a>.
    <br>
    
  </p>
</footer>

<script>
  function async(u, c) {
    var d = document, t = 'script',
      o = d.createElement(t),
      s = d.getElementsByTagName(t)[0];
    o.src = u;
    if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
    s.parentNode.insertBefore(o, s);
  }
</script>
<script>
  async("//cdn.bootcss.com/fastclick/1.0.6/fastclick.min.js", function(){
    FastClick.attach(document.body);
  })
</script>

<script>
  var hasLine = 'true';
  async("//cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js", function(){
    $('figure pre').each(function(i, block) {
      var figure = $(this).parents('figure');
      if (hasLine === 'false') {
        figure.find('.gutter').hide();
      }
      var lang = figure.attr('class').split(' ')[1] || 'code';
      var codeHtml = $(this).html();
      var codeTag = document.createElement('code');
      codeTag.className = lang;
      codeTag.innerHTML = codeHtml;
      $(this).attr('class', '').empty().html(codeTag);
      figure.attr('data-lang', lang.toUpperCase());
      hljs.highlightBlock(block);
    });
  })
</script>
<!-- Baidu Tongji -->

<script src="/js/script.js"></script>
  </body>
</html>