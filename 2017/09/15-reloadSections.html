<!DOCTYPE html>
<html>
  <head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
  <meta name="description" content="Matt Reach&#39;s blog">
  <meta name="keyword" content="许乾隆,Matt Reach,UITableView,reloadSections">
  
    <link rel="shortcut icon" href="/css/images/logo.png">
  
  <title>
    
      IOS 刷新 UITableView 的 section 时崩溃 | Matt Reach
    
  </title>
  
    <link rel="stylesheet" href="/css/style.css">
<link rel="stylesheet" href="/css/plugins/gitment.css">
  
  <link href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <link href="//cdn.bootcss.com/nprogress/0.2.0/nprogress.min.css" rel="stylesheet">
  <link href="//cdn.bootcss.com/highlight.js/9.12.0/styles/zenburn.min.css" rel="stylesheet">
  <script src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>
  <script src="//cdn.bootcss.com/geopattern/1.2.3/js/geopattern.min.js"></script>
  <script src="//cdn.bootcss.com/nprogress/0.2.0/nprogress.min.js"></script>
  <script src="/js/qrious.js"></script>
<script src="/js/gitment.js"></script>
</head>
<div class="wechat-share">
  <img src="/css/images/logo.png" />
</div>

  <body>
    <header class="header fixed-header">
  <div class="header-container">
    <a class="home-link" href="/">
      <div class="logo"></div>
      <span>Matt Reach</span>
    </a>
    <ul class="right-list">
      
        <li class="list-item">
          
            <a href="/" class="item-link">Home</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/tags/" class="item-link">Tags</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/project/" class="item-link">Projects</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/about/" class="item-link">About</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/zone/" class="item-link">Zone</a>
          
        </li>
      
    </ul>
    <div class="menu">
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </div>
    <div class="menu-mask">
      <ul class="menu-list">
        <!-- /zone/AAA
          2017BBB
          -1 -->
        
          <li class="menu-item">
            
              <a href="/" class="menu-link">Home</a>
            
          </li>
        
          <li class="menu-item">
            
              <a href="/tags/" class="menu-link">Tags</a>
            
          </li>
        
          <li class="menu-item">
            
              <a href="/project/" class="menu-link">Projects</a>
            
          </li>
        
          <li class="menu-item">
            
              <a href="/about/" class="menu-link">About</a>
            
          </li>
        
          <li class="menu-item">
            
              <a href="/zone/" class="menu-link">Zone</a>
            
          </li>
        
      </ul>
    </div>
  </div>
</header>

    <div id="article-banner">
  <h2>IOS 刷新 UITableView 的 section 时崩溃</h2>
  <!-- Tags START -->
  
    <div class="tags">
      <span><i class="fa fa-tags"></i></span>

  <a href="/tags#iOS" >
    <span class="tag-code">iOS,
    </span>
  </a>

  <a href="/tags#issues" >
    <span class="tag-code">issues
    </span>
  </a>

    </div>
  
  <!-- Tags END -->
  <p class="post-date">2017-09-15</p>
  <div class="arrow-down">
    <a href="javascript:;"></a>
  </div>
</div>

<div class="app-content">
<main class="app-body flex-box">
  <input type='checkbox' id='asideToggle'>
  <!-- Article START -->
  <article class="post-article">
      
        <div class="author">
        作者 : 朱泽光 。
        </div>
      
    <section class="markdown-content"><h2 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h2><p>在调用UITableView的如下方法时崩溃</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">NSIndexSet *indexSet=[[NSIndexSet alloc]initWithIndex:1];</span><br><span class="line">[tableview reloadSections:indexSet withRowAnimation:UITableViewRowAnimationNone];</span><br></pre></td></tr></table></figure>
<p>崩溃信息如下</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">*** Terminating app due to uncaught exception 'NSInternalInconsistencyException', reason: 'Invalid update: invalid number of rows in section 3.  The number of rows contained in an existing section after the update (1) must be equal to the number of rows contained in that section before the update (0), plus or minus the number of rows inserted or deleted from that section (0 inserted, 0 deleted) and plus or minus the number of rows moved into or out of that section (0 moved in, 0 moved out).'</span><br><span class="line">*** First throw call stack:</span><br><span class="line">(</span><br><span class="line">	<span class="number">0</span>   CoreFoundation                      <span class="number">0x0000000106ed0d4b</span> __exceptionPreprocess + <span class="number">171</span></span><br><span class="line">	<span class="number">1</span>   libobjc.A.dylib                     <span class="number">0x0000000105d5421e</span> objc_exception_throw + <span class="number">48</span></span><br><span class="line">	<span class="number">2</span>   CoreFoundation                      <span class="number">0x0000000106ed4e42</span> +[<span class="built_in">NSException</span> raise:format:arguments:] + <span class="number">98</span></span><br><span class="line">	<span class="number">3</span>   Foundation                          <span class="number">0x00000001058e966d</span> -[<span class="built_in">NSAssertionHandler</span> handleFailureInMethod:object:file:lineNumber:description:] + <span class="number">195</span></span><br><span class="line">	<span class="number">4</span>   <span class="built_in">UIKit</span>                               <span class="number">0x00000001094c377d</span> -[<span class="built_in">UITableView</span> _endCellAnimationsWithContext:] + <span class="number">17558</span></span><br><span class="line">	<span class="number">5</span>   <span class="built_in">UIKit</span>                               <span class="number">0x00000001094dac43</span> -[<span class="built_in">UITableView</span> _updateSections:updateAction:withRowAnimation:headerFooterOnly:] + <span class="number">487</span></span><br><span class="line">	<span class="number">6</span>   SohuLiveDemo                        <span class="number">0x0000000101a91ad3</span> __40-[SLAnchorsTabView loadRecommendAnchors]_block_invoke + <span class="number">771</span></span><br><span class="line">	<span class="number">7</span>   SohuLiveDemo                        <span class="number">0x0000000101ada0cb</span> __50-[<span class="built_in">SCNetworkService</span>(Maker) sendRequest:completion:]_block_invoke + <span class="number">155</span></span><br><span class="line">	<span class="number">8</span>   SohuLiveDemo                        <span class="number">0x0000000101942778</span> __39-[<span class="built_in">SCNetworkRequest</span> doFinishWithResult:]_block_invoke_2 + <span class="number">168</span></span><br><span class="line">	<span class="number">9</span>   CoreFoundation                      <span class="number">0x0000000106e600b2</span> __53-[__NSArrayM enumerateObjectsWithOptions:usingBlock:]_block_invoke + <span class="number">114</span></span><br><span class="line">	<span class="number">10</span>  CoreFoundation                      <span class="number">0x0000000106e5ff42</span> -[__NSArrayM enumerateObjectsWithOptions:usingBlock:] + <span class="number">194</span></span><br><span class="line">	<span class="number">11</span>  SohuLiveDemo                        <span class="number">0x00000001019425e2</span> __39-[<span class="built_in">SCNetworkRequest</span> doFinishWithResult:]_block_invoke + <span class="number">194</span></span><br><span class="line">	<span class="number">12</span>  libdispatch.dylib                   <span class="number">0x000000010b8f1978</span> _dispatch_call_block_and_release + <span class="number">12</span></span><br><span class="line">	<span class="number">13</span>  libdispatch.dylib                   <span class="number">0x000000010b91b0cd</span> _dispatch_client_callout + <span class="number">8</span></span><br><span class="line">	<span class="number">14</span>  libdispatch.dylib                   <span class="number">0x000000010b8fb8a4</span> _dispatch_main_queue_callback_4CF + <span class="number">406</span></span><br><span class="line">	<span class="number">15</span>  CoreFoundation                      <span class="number">0x0000000106e94e49</span> __CFRUNLOOP_IS_SERVICING_THE_MAIN_DISPATCH_QUEUE__ + <span class="number">9</span></span><br><span class="line">	<span class="number">16</span>  CoreFoundation                      <span class="number">0x0000000106e5a37d</span> __CFRunLoopRun + <span class="number">2205</span></span><br><span class="line">	<span class="number">17</span>  CoreFoundation                      <span class="number">0x0000000106e59884</span> <span class="built_in">CFRunLoopRunSpecific</span> + <span class="number">420</span></span><br><span class="line">	<span class="number">18</span>  GraphicsServices                    <span class="number">0x000000010c7a2a6f</span> GSEventRunModal + <span class="number">161</span></span><br><span class="line">	<span class="number">19</span>  <span class="built_in">UIKit</span>                               <span class="number">0x0000000109384c68</span> <span class="built_in">UIApplicationMain</span> + <span class="number">159</span></span><br><span class="line">	<span class="number">20</span>  SohuLiveDemo                        <span class="number">0x000000010031b3ef</span> main + <span class="number">111</span></span><br><span class="line">	<span class="number">21</span>  libdyld.dylib                       <span class="number">0x000000010b96768d</span> start + <span class="number">1</span></span><br><span class="line">)</span><br><span class="line">libc++abi.dylib: terminating with uncaught exception of type <span class="built_in">NSException</span></span><br></pre></td></tr></table></figure>
<h2 id="问题分析"><a href="#问题分析" class="headerlink" title="问题分析"></a>问题分析</h2><p>崩溃信息描述大概是这个意思，这个刷新无效，具体指section 3的行数无效。下面给出了具体的原因，section 3刷新前是1行，刷新后变成了0行，而在reloadSections的set里边又没有包含要刷新的section 3，故表在刷新的时候就报错了。这个问题该如何解决呢？</p>
<ol>
<li>我们在局部刷新的时候，若表数据改变了，一定要把所有改变的区，或者是行都包含进去，才能避免崩溃。</li>
<li>若section的row是动态变化的，考虑直接使用reloadData，可避免崩溃。</li>
</ol>
</section>
    <!-- Post Nav START -->
    
      <div class="postnav">
          
    <div>
        <span>上一篇 :</span>
        <a href="/2017/09/14-layerAnimation_frame.html">Core Animation 与 UIView.frame</a>
      </div>
   
  
    <div>
        <span>下一篇 : </span>
        <a href="/2017/09/15-360rotate.html">实现一个图片 360 度不停旋转</a>
    </div>
   
      </div>
      
    <!-- Post Nav END -->
      
    <!-- 打赏 START -->
    
      <div class="money-like">
        <div class="reward-btn">
          赏
          <span class="money-code">
            <span class="alipay-code">
              <div class="code-image"></div>
              <b>使用支付宝打赏</b>
            </span>
            <span class="wechat-code">
              <div class="code-image"></div>
              <b>使用微信打赏</b>
            </span>
          </span>
        </div>
        <p class="notice">若你觉得我的文章对你有帮助，欢迎点击上方按钮对我打赏</p>
      </div>
    
    <!-- 打赏 END -->
    <!-- 二维码 START -->
    
      <div class="qrcode">
        <canvas id="share-qrcode"></canvas>
        <p class="notice">扫描二维码，分享此文章</p>
      </div>
    
    <!-- 二维码 END -->
    
      <!-- Gitment START -->
      <div id="gitment"></div>
      <!-- Gitment END -->
    

  </article>
  <!-- Article END -->
  <!-- Catalog START -->
  
    
<aside class="catalog-container">
  <div class="toc-indicator">
    <label for="asideToggle" id="asideToggleLabel"><</label>
  </div>
  <div class="toc-main">
    <strong class="toc-title">目录</strong>
    
      <ol class="toc-nav"><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#问题描述"><span class="toc-nav-number">1.</span> <span class="toc-nav-text">问题描述</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#问题分析"><span class="toc-nav-number">2.</span> <span class="toc-nav-text">问题分析</span></a></li></ol>
    
  </div>
</aside>

  
  <!-- Catalog END -->
</main>
</div>

<script>
  (function () {
    var banner = ''
    if (banner !== '' && banner !== 'undefined' && banner !== 'null') {
      $('#article-banner').css({
        'background-image': 'url("' + banner + '")'
      })
    } else {
      var url = 'http://debugly.cn/2017/09/15-reloadSections.html';
      $('#article-banner').geopattern(url)
    }
    $('.header').removeClass('fixed-header')

     // error image
    $(".markdown-content img").on('error', function() {
      $(this).attr('src', '/css/images/404.png')
      $(this).css({
        'cursor': 'default'
      })
    })

    // zoom image
    $(".markdown-content img").on('click', function() {
      var src = $(this).attr('src')
      if (src !== '/css/images/404.png') {
        var imageW = $(this).width()
        var imageH = $(this).height()

        var zoom = ($(window).width() * 0.95 / imageW).toFixed(2)
        zoom = zoom < 1 ? 1 : zoom
        zoom = zoom > 2 ? 2 : zoom
        var transY = (($(window).height() - imageH) / 2).toFixed(2)

        $('body').append('<div class="image-view-wrap"><div class="image-view-inner"><img src="'+ src +'" /></div></div>')
        $('.image-view-wrap').addClass('wrap-active')
        $('.image-view-wrap img').css({
          'width': `${imageW}`,
          'transform': `translate3d(0, ${transY}px, 0) scale3d(${zoom}, ${zoom}, 1)`
        })
        $('html').css('overflow', 'hidden')

        $('.image-view-wrap').on('click', function() {
          $(this).remove()
          $('html').attr('style', '')
        })
      }
    })

    // qrcode
    var qr = new QRious({
      element: document.getElementById('share-qrcode'),
      value: document.location.href
    });

    // gitment
    var gitmentConfig = "debugly";
    if (gitmentConfig !== 'undefined') {
      var gitment = new Gitment({
        id: "IOS 刷新 UITableView 的 section 时崩溃",
        owner: "debugly",
        repo: "debugly.github.io",
        oauth: {
          client_id: "ef799a3a8ea3c51cd976",
          client_secret: "0c9fe417f7acc5d01b90186f949fee2faefffc30"
        },
        theme: {
          render(state, instance) {
            const container = document.createElement('div')
            container.lang = "en-US"
            container.className = 'gitment-container gitment-root-container'
            container.appendChild(instance.renderHeader(state, instance))
            container.appendChild(instance.renderEditor(state, instance))
            container.appendChild(instance.renderComments(state, instance))
            container.appendChild(instance.renderFooter(state, instance))
            return container;
          }
        }
      })
      gitment.render(document.getElementById('gitment'))
    }
  })();
</script>

    <div class="scroll-top">
  <span class="arrow-icon"></span>
</div>
    <footer class="app-footer">
  <p class="copyright">
      Copyright &copy; 2018.
      Powered by <a href="https://hexo.io" target="_blank">Hexo</a>.
      Theme by <a href="https://github.com/debugly/hexo-theme-yaris">hexo-theme-yaris</a>.
      Hosted on <a href="https://github.com/" target="_blank">GitHub</a>.
    <br>
    
  </p>
</footer>

<script>
  function async(u, c) {
    var d = document, t = 'script',
      o = d.createElement(t),
      s = d.getElementsByTagName(t)[0];
    o.src = u;
    if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
    s.parentNode.insertBefore(o, s);
  }
</script>
<script>
  async("//cdn.bootcss.com/fastclick/1.0.6/fastclick.min.js", function(){
    FastClick.attach(document.body);
  })
</script>

<script>
  var hasLine = 'true';
  async("//cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js", function(){
    $('figure pre').each(function(i, block) {
      var figure = $(this).parents('figure');
      if (hasLine === 'false') {
        figure.find('.gutter').hide();
      }
      var lang = figure.attr('class').split(' ')[1] || 'code';
      var codeHtml = $(this).html();
      var codeTag = document.createElement('code');
      codeTag.className = lang;
      codeTag.innerHTML = codeHtml;
      $(this).attr('class', '').empty().html(codeTag);
      figure.attr('data-lang', lang.toUpperCase());
      hljs.highlightBlock(block);
    });
  })
</script>
<!-- Baidu Tongji -->

<script src="/js/script.js"></script>
  </body>
</html>